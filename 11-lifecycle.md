

# **📌 صفحه 11 - چرخه حیات کامپوننت‌ها در Vue.js**  

در این صفحه، **مراحل مختلف چرخه حیات کامپوننت‌ها** و **هوک‌های چرخه حیات** را بررسی خواهیم کرد. همچنین، یک **مثال عملی** برای درک بهتر مدیریت منابع در این هوک‌ها پیاده‌سازی می‌کنیم.  

✅ **مراحل مختلف چرخه حیات**  
✅ **هوک‌های چرخه حیات و کاربردهای آن‌ها**  
✅ **مثال عملی: مدیریت منابع در هوک‌های چرخه حیات**  

---

## **۱. چرخه حیات کامپوننت در Vue.js چیست؟**  

در Vue.js، هر **کامپوننت** یک **چرخه حیات (Lifecycle)** دارد که شامل مراحل مختلفی از **ایجاد شدن (Creation)** تا **نابود شدن (Destruction)** است. Vue این مراحل را با استفاده از **هوک‌های چرخه حیات (Lifecycle Hooks)** مدیریت می‌کند.  

---

## **۲. مراحل مختلف چرخه حیات کامپوننت‌ها**  

🔹 **ایجاد (Creation):** کامپوننت مقداردهی اولیه می‌شود، اما هنوز در DOM قرار نگرفته است.  
🔹 **نصب (Mounting):** کامپوننت در DOM قرار می‌گیرد و Vue آن را نمایش می‌دهد.  
🔹 **بروزرسانی (Updating):** وقتی که داده‌های واکنشی تغییر کنند، Vue دوباره کامپوننت را بروزرسانی می‌کند.  
🔹 **نابودی (Unmounting):** زمانی که کامپوننت حذف شود، Vue عملیات پاکسازی را انجام می‌دهد.  

📌 در Vue.js برای مدیریت این مراحل، **هوک‌های چرخه حیات** را ارائه می‌دهد.  

---

## **۳. هوک‌های چرخه حیات در Vue.js**  

### **🔹 هوک‌های مربوط به ایجاد شدن کامپوننت (Creation Hooks)**  

✅ `setup()`  
📌 مقداردهی اولیه کامپوننت را انجام می‌دهد و می‌توان داده‌ها را مقداردهی کرد.  
```vue
<script setup>
import { ref, onMounted } from 'vue'

const message = ref("Vue در حال بارگذاری است...")
</script>
```

**توجه:** در Vue 3، متدهای `beforeCreate` و `created` دیگر به‌صورت مستقیم در دسترس نیستند و نمی‌توان از آن‌ها استفاده کرد. به‌جای آن، می‌توانیم از `setup()` برای مقداردهی اولیه استفاده کنیم.

✅ `onBeforeMount()`  
📌 قبل از اینکه کامپوننت در DOM قرار گیرد اجرا می‌شود.  

✅ `onMounted()`  
📌 وقتی که کامپوننت در DOM قرار گرفت اجرا می‌شود.  
📌 برای فراخوانی API یا مقداردهی داده‌ها استفاده می‌شود.  
```vue
onMounted(() => {
  console.log("کامپوننت در DOM قرار گرفت ✅")
})
```

---

### **🔹 هوک‌های مربوط به بروزرسانی کامپوننت (Update Hooks)**  

✅ `onBeforeUpdate()`  
📌 قبل از بروزرسانی کامپوننت اجرا می‌شود.  

✅ `onUpdated()`  
📌 بعد از بروزرسانی کامپوننت اجرا می‌شود.  
```vue
import { onUpdated } from 'vue'

onUpdated(() => {
  console.log("کامپوننت بروزرسانی شد 🔄")
})
```

---

### **🔹 هوک‌های مربوط به نابودی کامپوننت (Unmount Hooks)**  

✅ `onBeforeUnmount()`  
📌 قبل از حذف شدن کامپوننت از DOM اجرا می‌شود.  

✅ `onUnmounted()`  
📌 پس از حذف شدن کامپوننت اجرا شده و برای پاکسازی منابع استفاده می‌شود.  
```vue
import { onUnmounted } from 'vue'

onUnmounted(() => {
  console.log("کامپوننت حذف شد ❌")
})
```

---

## **۴. مثال عملی: مدیریت منابع در هوک‌های چرخه حیات**  

در این مثال، یک **کامپوننت تایمر** ایجاد می‌کنیم که از **هوک‌های چرخه حیات** استفاده می‌کند.

📁 `Timer.vue`  
```vue
<template>
  <div>
    <h2>چرخه حیات کامپوننت Vue</h2>
    <h3>زمان سپری شده: {{ time }} ثانیه</h3>
    <button @click="resetTimer">تنظیم مجدد</button>
  </div>
</template>

<script setup>
import { ref, onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted } from 'vue'

// ایجاد یک متغیر واکنش‌گرا برای زمان
const time = ref(0)
let interval = null

// تابع برای تنظیم مجدد تایمر
const resetTimer = () => {
  time.value = 0
}

// متد قبل از ایجاد کامپوننت
console.log("🔄 beforeCreate: کامپوننت در حال ایجاد است.")

// متد بعد از ایجاد کامپوننت
console.log("✅ created: کامپوننت ایجاد شد.")

// متد قبل از متصل شدن به DOM
onBeforeMount(() => {
  console.log("📦 beforeMount: کامپوننت در حال متصل شدن به DOM است.")
})

// متد بعد از متصل شدن به DOM
onMounted(() => {
  console.log("🚀 mounted: کامپوننت به DOM متصل شد.")
  interval = setInterval(() => {
    time.value++ // افزایش زمان به ازای هر ثانیه
  }, 1000)
})

// متد قبل از به‌روزرسانی
onBeforeUpdate(() => {
  console.log("🔄 beforeUpdate: کامپوننت در حال به‌روزرسانی است.")
})

// متد بعد از به‌روزرسانی
onUpdated(() => {
  console.log("✅ updated: کامپوننت به‌روزرسانی شد.")
})

// متد قبل از حذف از DOM
onBeforeUnmount(() => {
  console.log("🗑️ beforeUnmount: کامپوننت در حال حذف از DOM است.")
})

// متد بعد از حذف از DOM
onUnmounted(() => {
  console.log("⏹️ unmounted: کامپوننت از DOM حذف شد.")
  clearInterval(interval) // پاک کردن interval برای جلوگیری از نشت حافظه
})
</script>

<style scoped>
/* استایل‌های ساده برای زیبایی */
div {
  text-align: center;
  margin-top: 20px;
}

h2 {
  font-size: 24px;
  color: #333;
}

h3 {
  font-size: 20px;
  color: #555;
}

button {
  padding: 10px 15px;
  background-color: #42b983;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #3aa876;
}
</style>
```

🔹 **`onMounted`** تایمر را هنگام ایجاد کامپوننت **فعال** می‌کند.  
🔹 **`onUnmounted`** تایمر را هنگام حذف کامپوننت **پاکسازی** می‌کند.  

✅ این تکنیک در مدیریت **اتصالات WebSocket**، **اشتراک‌گذاری داده‌ها** و **پاکسازی تایمرها** کاربرد دارد.  

---

## **📌 جمع‌بندی این صفحه**  

✅ **چرخه حیات کامپوننت‌ها** شامل **ایجاد، نصب، بروزرسانی و نابودی** است.  
✅ **Vue.js برای مدیریت چرخه حیات، هوک‌های متنوعی را ارائه می‌دهد.**  
✅ از **onMounted** برای مقداردهی و از **onUnmounted** برای پاکسازی استفاده می‌شود.  
✅ **مثال تایمر** را برای درک بهتر پیاده‌سازی کردیم.  

---

